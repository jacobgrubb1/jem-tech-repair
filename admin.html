<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel | Jem Tech Repair</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ===== Admin Styles ===== */
    .admin-login {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-alt);
      padding: 24px;
    }

    .login-box {
      background: var(--bg);
      border-radius: var(--radius);
      padding: 48px 40px;
      max-width: 400px;
      width: 100%;
      box-shadow: var(--shadow-lg);
      text-align: center;
    }

    .login-box h1 {
      font-size: 1.6rem;
      font-weight: 800;
      color: var(--secondary);
      margin-bottom: 8px;
    }

    .login-box p {
      color: var(--text-light);
      margin-bottom: 28px;
      font-size: 0.95rem;
    }

    .login-box input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: inherit;
      font-size: 1rem;
      margin-bottom: 16px;
    }

    .login-box input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(245, 130, 32, 0.15);
    }

    .login-error {
      color: #ef4444;
      font-size: 0.85rem;
      margin-bottom: 12px;
      display: none;
    }

    /* Dashboard */
    .admin-dashboard {
      display: none;
      padding-top: 90px;
      min-height: 100vh;
      background: var(--bg-alt);
    }

    .admin-dashboard.visible {
      display: block;
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      margin-bottom: 32px;
    }

    .admin-header h1 {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--secondary);
    }

    .admin-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn-sm {
      padding: 10px 20px;
      font-size: 0.9rem;
    }

    .btn-success {
      background: #059669;
      color: #fff;
      border-color: #059669;
    }

    .btn-success:hover {
      background: #047857;
      border-color: #047857;
    }

    .btn-danger {
      background: #ef4444;
      color: #fff;
      border-color: #ef4444;
    }

    .btn-danger:hover {
      background: #dc2626;
      border-color: #dc2626;
    }

    .btn-secondary {
      background: var(--secondary);
      color: #fff;
      border-color: var(--secondary);
    }

    .btn-secondary:hover {
      background: #0a2d52;
      border-color: #0a2d52;
    }

    /* Product Table */
    .admin-table-wrapper {
      background: var(--bg);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      overflow-x: auto;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    .admin-table th {
      background: var(--bg-alt);
      padding: 14px 16px;
      text-align: left;
      font-weight: 700;
      color: var(--secondary);
      border-bottom: 2px solid var(--border);
      white-space: nowrap;
    }

    .admin-table td {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }

    .admin-table tr:last-child td {
      border-bottom: none;
    }

    .admin-table tr:hover {
      background: #fafbfc;
    }

    .status-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 50px;
      font-size: 0.78rem;
      font-weight: 600;
    }

    .status-badge.available {
      background: #ecfdf5;
      color: #059669;
    }

    .status-badge.sold {
      background: #fef2f2;
      color: #ef4444;
    }

    .table-actions {
      display: flex;
      gap: 8px;
    }

    .table-actions button {
      padding: 6px 14px;
      font-size: 0.8rem;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--bg);
      color: var(--text);
      font-family: inherit;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .table-actions button:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .table-actions button.delete-btn:hover {
      border-color: #ef4444;
      color: #ef4444;
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .modal-overlay.visible {
      display: flex;
    }

    .modal {
      background: var(--bg);
      border-radius: var(--radius);
      padding: 36px;
      max-width: 560px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
    }

    .modal h2 {
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--secondary);
      margin-bottom: 24px;
    }

    .modal .form-group {
      margin-bottom: 18px;
    }

    .modal .form-group label {
      display: block;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
    }

    .modal .form-group input,
    .modal .form-group textarea,
    .modal .form-group select {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: inherit;
      font-size: 0.9rem;
      background: var(--bg);
    }

    .modal .form-group input:focus,
    .modal .form-group textarea:focus,
    .modal .form-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(245, 130, 32, 0.15);
    }

    .modal .form-group textarea {
      resize: vertical;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
    }

    .empty-state span {
      font-size: 3rem;
      display: block;
      margin-bottom: 12px;
    }

    .admin-note {
      margin-top: 24px;
      padding: 16px 20px;
      background: var(--primary-light);
      border-radius: 8px;
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.6;
    }

    .admin-note strong {
      color: var(--secondary);
    }

    @media (max-width: 768px) {
      .login-box {
        padding: 32px 24px;
      }

      .modal {
        padding: 24px;
      }

      .admin-table {
        font-size: 0.8rem;
      }

      .admin-table th,
      .admin-table td {
        padding: 10px 12px;
      }
    }
  </style>
</head>
<body>

  <!-- Login Screen -->
  <div class="admin-login" id="loginScreen">
    <div class="login-box">
      <h1>Admin Panel</h1>
      <p>Enter your admin password to manage inventory.</p>
      <p class="login-error" id="loginError">Incorrect password. Try again.</p>
      <input type="password" id="passwordInput" placeholder="Enter password" autofocus>
      <button class="btn btn-primary btn-full" id="loginBtn">Sign In</button>
    </div>
  </div>

  <!-- Navigation (shown after login) -->
  <nav class="navbar" id="navbar" style="display:none;">
    <div class="container nav-container">
      <a href="index.html" class="logo">
        <img src="JemTechLogo.PNG" alt="Jem Tech Repair" class="logo-img"> Jem Tech Repair
      </a>
      <ul class="nav-links" style="display:flex;">
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="admin.html" class="active">Admin</a></li>
      </ul>
    </div>
  </nav>

  <!-- Dashboard -->
  <div class="admin-dashboard" id="dashboard">
    <div class="container">
      <div class="admin-header">
        <h1>Manage Inventory</h1>
        <div class="admin-actions">
          <button class="btn btn-primary btn-sm" id="addProductBtn">+ Add Product</button>
          <button class="btn btn-success btn-sm" id="exportBtn">Export products.json</button>
          <button class="btn btn-secondary btn-sm" id="logoutBtn">Log Out</button>
        </div>
      </div>

      <div class="admin-table-wrapper">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Category</th>
              <th>Condition</th>
              <th>Price</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="productTableBody">
          </tbody>
        </table>
        <div class="empty-state" id="emptyState" style="display:none;">
          <span>&#128230;</span>
          <p>No products yet. Click "Add Product" to list your first item.</p>
        </div>
      </div>

      <div class="admin-note">
        <strong>How it works:</strong> Changes you make here are saved to your browser and will immediately appear on the Shop page when viewed from this device. To make changes live for everyone, click <strong>"Export products.json"</strong> to download the file, then replace the existing <code>products.json</code> in your GitHub repository and push the update.
      </div>
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div class="modal-overlay" id="productModal">
    <div class="modal">
      <h2 id="modalTitle">Add Product</h2>
      <form id="productForm">
        <input type="hidden" id="productId">
        <div class="form-group">
          <label for="productName">Product Name</label>
          <input type="text" id="productName" required placeholder="e.g. Dell Latitude 5520 Laptop">
        </div>
        <div class="form-group">
          <label for="productCategory">Category</label>
          <select id="productCategory">
            <option value="Laptops">Laptops</option>
            <option value="Desktops">Desktops</option>
            <option value="Phones">Phones</option>
            <option value="Tablets">Tablets</option>
            <option value="Gaming">Gaming</option>
            <option value="Accessories">Accessories</option>
          </select>
        </div>
        <div class="form-group">
          <label for="productCondition">Condition</label>
          <select id="productCondition">
            <option value="Excellent">Excellent</option>
            <option value="Good">Good</option>
            <option value="Fair">Fair</option>
          </select>
        </div>
        <div class="form-group">
          <label for="productPrice">Price ($)</label>
          <input type="number" id="productPrice" required min="0" step="0.01" placeholder="199.99">
        </div>
        <div class="form-group">
          <label for="productImage">Image URL (optional)</label>
          <input type="text" id="productImage" placeholder="https://... or leave blank for placeholder">
        </div>
        <div class="form-group">
          <label for="productDescription">Description</label>
          <textarea id="productDescription" rows="3" required placeholder="Describe the item, specs, what's included..."></textarea>
        </div>
        <div class="form-group">
          <label for="productAvailable">Availability</label>
          <select id="productAvailable">
            <option value="true">Available</option>
            <option value="false">Sold</option>
          </select>
        </div>
        <div class="modal-buttons">
          <button type="button" class="btn btn-outline btn-sm" id="cancelModal">Cancel</button>
          <button type="submit" class="btn btn-primary btn-sm" id="saveProduct">Save Product</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ===== Config =====
    // CHANGE THIS PASSWORD to something secure!
    const ADMIN_PASSWORD = 'jemtech2026';
    const STORAGE_KEY = 'jemtech_products';

    // ===== Elements =====
    const loginScreen = document.getElementById('loginScreen');
    const dashboard = document.getElementById('dashboard');
    const navbar = document.getElementById('navbar');
    const passwordInput = document.getElementById('passwordInput');
    const loginBtn = document.getElementById('loginBtn');
    const loginError = document.getElementById('loginError');
    const logoutBtn = document.getElementById('logoutBtn');
    const productTableBody = document.getElementById('productTableBody');
    const emptyState = document.getElementById('emptyState');
    const addProductBtn = document.getElementById('addProductBtn');
    const exportBtn = document.getElementById('exportBtn');
    const productModal = document.getElementById('productModal');
    const productForm = document.getElementById('productForm');
    const cancelModal = document.getElementById('cancelModal');
    const modalTitle = document.getElementById('modalTitle');

    let products = [];

    // ===== Login =====
    function login() {
      if (passwordInput.value === ADMIN_PASSWORD) {
        loginScreen.style.display = 'none';
        dashboard.classList.add('visible');
        navbar.style.display = 'block';
        sessionStorage.setItem('jemtech_admin', 'true');
        loadProducts();
      } else {
        loginError.style.display = 'block';
        passwordInput.value = '';
        passwordInput.focus();
      }
    }

    loginBtn.addEventListener('click', login);
    passwordInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') login();
    });

    logoutBtn.addEventListener('click', () => {
      sessionStorage.removeItem('jemtech_admin');
      location.reload();
    });

    // Auto-login if session is active
    if (sessionStorage.getItem('jemtech_admin') === 'true') {
      loginScreen.style.display = 'none';
      dashboard.classList.add('visible');
      navbar.style.display = 'block';
      loadProducts();
    }

    // ===== Load Products =====
    async function loadProducts() {
      const localData = localStorage.getItem(STORAGE_KEY);
      if (localData) {
        try {
          products = JSON.parse(localData);
          renderTable();
          return;
        } catch (e) { /* fall through */ }
      }

      try {
        const res = await fetch('products.json');
        products = await res.json();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
        renderTable();
      } catch (e) {
        products = [];
        renderTable();
      }
    }

    function saveProducts() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
    }

    // ===== Render Table =====
    function renderTable() {
      if (products.length === 0) {
        productTableBody.innerHTML = '';
        emptyState.style.display = 'block';
        return;
      }

      emptyState.style.display = 'none';
      productTableBody.innerHTML = products.map(p => `
        <tr>
          <td><strong>${p.name}</strong></td>
          <td>${p.category || '—'}</td>
          <td>${p.condition || '—'}</td>
          <td>$${p.price.toFixed(2)}</td>
          <td>
            <span class="status-badge ${p.available !== false ? 'available' : 'sold'}">
              ${p.available !== false ? 'Available' : 'Sold'}
            </span>
          </td>
          <td>
            <div class="table-actions">
              <button onclick="editProduct('${p.id}')">Edit</button>
              <button class="delete-btn" onclick="deleteProduct('${p.id}')">Delete</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // ===== Add / Edit Product =====
    addProductBtn.addEventListener('click', () => {
      modalTitle.textContent = 'Add Product';
      productForm.reset();
      document.getElementById('productId').value = '';
      document.getElementById('productAvailable').value = 'true';
      productModal.classList.add('visible');
    });

    function editProduct(id) {
      const product = products.find(p => p.id === id);
      if (!product) return;

      modalTitle.textContent = 'Edit Product';
      document.getElementById('productId').value = product.id;
      document.getElementById('productName').value = product.name;
      document.getElementById('productCategory').value = product.category || 'Laptops';
      document.getElementById('productCondition').value = product.condition || 'Good';
      document.getElementById('productPrice').value = product.price;
      document.getElementById('productImage').value = product.image || '';
      document.getElementById('productDescription').value = product.description;
      document.getElementById('productAvailable').value = String(product.available !== false);
      productModal.classList.add('visible');
    }

    cancelModal.addEventListener('click', () => {
      productModal.classList.remove('visible');
    });

    productModal.addEventListener('click', (e) => {
      if (e.target === productModal) productModal.classList.remove('visible');
    });

    productForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const id = document.getElementById('productId').value;
      const productData = {
        id: id || Date.now().toString(),
        name: document.getElementById('productName').value,
        category: document.getElementById('productCategory').value,
        condition: document.getElementById('productCondition').value,
        price: parseFloat(document.getElementById('productPrice').value),
        image: document.getElementById('productImage').value,
        description: document.getElementById('productDescription').value,
        available: document.getElementById('productAvailable').value === 'true'
      };

      if (id) {
        // Edit existing
        const index = products.findIndex(p => p.id === id);
        if (index > -1) products[index] = productData;
      } else {
        // Add new
        products.push(productData);
      }

      saveProducts();
      renderTable();
      productModal.classList.remove('visible');
    });

    // ===== Delete Product =====
    function deleteProduct(id) {
      if (!confirm('Are you sure you want to delete this product?')) return;
      products = products.filter(p => p.id !== id);
      saveProducts();
      renderTable();
    }

    // ===== Export =====
    exportBtn.addEventListener('click', () => {
      const json = JSON.stringify(products, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'products.json';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
